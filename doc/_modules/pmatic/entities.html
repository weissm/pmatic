
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>pmatic.entities &#8212; pmatic 0.1 documentation</title>
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinxcontrib-images/LightBox2/lightbox2/css/lightbox.css" />
    
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2/js/jquery-1.11.0.min.js"></script>
    <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2/js/lightbox.min.js"></script>
    <script src="../../_static/sphinxcontrib-images/LightBox2/lightbox2-customize/jquery-noconflict.js"></script>
    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pmatic 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../pmatic.html" accesskey="U">pmatic</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pmatic.entities</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># encoding: utf-8</span>
<span class="c1">#</span>
<span class="c1"># pmatic - Python API for Homematic. Easy to use.</span>
<span class="c1"># Copyright (C) 2016 Lars Michelsen &lt;lm@larsmichelsen.com&gt;</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; either version 2 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License along</span>
<span class="c1"># with this program; if not, write to the Free Software Foundation, Inc.,</span>
<span class="c1"># 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.</span>

<span class="c1"># Relevant docs:</span>
<span class="c1"># - http://www.eq-3.de/Downloads/PDFs/Dokumentation_und_Tutorials/HM_XmlRpc_V1_502__2_.pdf</span>
<span class="c1"># - http://www.eq-3.de/Downloads/eq3/download%20bereich/hm_web_ui_doku/hm_devices_Endkunden.pdf</span>

<span class="c1"># Add Python 3.x behaviour to 2.7</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">unicode_literals</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="mi">1</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">object</span> <span class="c1"># pylint:disable=redefined-builtin</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="kn">import</span> <span class="nn">pmatic.params</span>
<span class="kn">import</span> <span class="nn">pmatic.utils</span> <span class="k">as</span> <span class="nn">utils</span>
<span class="kn">from</span> <span class="nn">pmatic.exceptions</span> <span class="kn">import</span> <span class="n">PMException</span><span class="p">,</span> <span class="n">PMDeviceOffline</span>

<span class="k">class</span> <span class="nc">Entity</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">_transform_attributes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">_skip_attributes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">_mandatory_attributes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ccu</span><span class="p">,</span> <span class="n">pmatic</span><span class="o">.</span><span class="n">ccu</span><span class="o">.</span><span class="n">CCU</span><span class="p">),</span> <span class="s2">&quot;ccu is not of CCU class: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ccu</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="nb">dict</span><span class="p">),</span> <span class="s2">&quot;spec is not a dictionary: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">spec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span> <span class="o">=</span> <span class="n">ccu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_verify_mandatory_attributes</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Entity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_set_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adding provided attributes to this entity.</span>

<span class="sd">        Transforming and filtering dictionaries containing attributes for this entity</span>
<span class="sd">        by using the configured transform methods for the individual attributes and also</span>
<span class="sd">        excluding some attributes which keys are in self._skip_attributes.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="n">obj_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">obj_dict</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_skip_attributes</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Optionally convert values using the given transform functions</span>
            <span class="c1"># for the specific object type</span>
            <span class="n">trans_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_transform_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trans_func</span><span class="p">:</span>
                <span class="n">func_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">trans_func</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="k">if</span> <span class="n">func_type</span> <span class="ow">in</span> <span class="p">[</span> <span class="s2">&quot;instancemethod&quot;</span><span class="p">,</span> <span class="s2">&quot;function&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span> <span class="p">]:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">offset</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">func_type</span> <span class="ow">in</span> <span class="p">[</span> <span class="s2">&quot;instancemethod&quot;</span><span class="p">,</span> <span class="s2">&quot;method&quot;</span> <span class="p">]</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">argcount</span> <span class="o">=</span> <span class="n">trans_func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_argcount</span>
                    <span class="k">for</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="n">trans_func</span><span class="o">.</span><span class="vm">__code__</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">argcount</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">arg_name</span> <span class="o">==</span> <span class="s2">&quot;api&quot;</span><span class="p">:</span>
                            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="o">.</span><span class="n">api</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">arg_name</span> <span class="o">==</span> <span class="s2">&quot;ccu&quot;</span><span class="p">:</span>
                            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">arg_name</span> <span class="o">==</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span>
                            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">arg_name</span> <span class="o">==</span> <span class="s2">&quot;obj&quot;</span><span class="p">:</span>
                            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>

                <span class="n">val</span> <span class="o">=</span> <span class="n">trans_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

            <span class="c1"># Transform keys from camel case to our style</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">decamel</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_verify_mandatory_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mandatory_attributes</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;The mandatory attribute </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> is missing.&quot;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>



<span class="k">class</span> <span class="nc">Channels</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This class has been created to make the dict where the channels are stored</span>
<span class="sd">    in to have a similar interface like a list.</span>

<span class="sd">    We want to have a consistent interface when e.g. doing this:</span>

<span class="sd">    ```</span>
<span class="sd">    for device in ccu.devices:</span>
<span class="sd">        for channel in device.channels:</span>
<span class="sd">            ...</span>
<span class="sd">    ```</span>

<span class="sd">    With only a dict for device.channels it would need device.channels.values()</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">mylist</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>



<div class="viewcode-block" id="Channel"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Channel">[docs]</a><span class="k">class</span> <span class="nc">Channel</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">LogMixin</span><span class="p">,</span> <span class="n">Entity</span><span class="p">):</span>
    <span class="n">_transform_attributes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># ReGa attributes:</span>
        <span class="s2">&quot;id&quot;</span>               <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;partner_id&quot;</span>       <span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>
        <span class="c1"># Low level attributes:</span>
        <span class="s2">&quot;aes_active&quot;</span>        <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="s2">&quot;link_source_roles&quot;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
        <span class="s2">&quot;link_target_roles&quot;</span> <span class="p">:</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">else</span> <span class="n">v</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Don&#39;t add these keys to the objects attributes</span>
    <span class="n">_skip_attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Low level attributes:</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">,</span>
        <span class="s2">&quot;parent_type&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="c1"># These keys have to be set after attribute initialization</span>
    <span class="n">_mandatory_attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Low level attributes:</span>

        <span class="c1"># address of channel</span>
        <span class="s2">&quot;address&quot;</span><span class="p">,</span>
        <span class="c1"># communication direction of channel:</span>
        <span class="c1"># 0 = DIRECTION_NONE (Kanal unterstützt keine direkte Verknüpfung)</span>
        <span class="c1"># 1 = DIRECTION_SENDER</span>
        <span class="c1"># 2 = DIRECTION_RECEIVER</span>
        <span class="s2">&quot;direction&quot;</span><span class="p">,</span>
        <span class="c1"># see device flags (0x01 visible, 0x02 internal, 0x08 can not be deleted)</span>
        <span class="s2">&quot;flags&quot;</span><span class="p">,</span>
        <span class="c1"># channel number</span>
        <span class="s2">&quot;index&quot;</span><span class="p">,</span>
        <span class="c1"># possible roles as sender</span>
        <span class="s2">&quot;link_source_roles&quot;</span><span class="p">,</span>
        <span class="c1"># possible roles as receiver</span>
        <span class="s2">&quot;link_target_roles&quot;</span><span class="p">,</span>
        <span class="c1"># list of available parameter sets</span>
        <span class="s2">&quot;paramsets&quot;</span><span class="p">,</span>
        <span class="c1"># type of this channel</span>
        <span class="s2">&quot;type&quot;</span><span class="p">,</span>
        <span class="c1"># version of the channel description</span>
        <span class="s2">&quot;version&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Device</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;Device object is not a Device derived class: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_values_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks_to_register</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;value_updated&quot;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s2">&quot;value_changed&quot;</span><span class="p">:</span> <span class="p">[],</span>
        <span class="p">}</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Channel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">device</span><span class="o">.</span><span class="n">_ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>


<div class="viewcode-block" id="Channel.from_channel_dicts"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Channel.from_channel_dicts">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_channel_dicts</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">channel_dicts</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates channel instances associated with the given *device* instance from the given</span>
<span class="sd">        attribute dictionaries.</span>

<span class="sd">        Uses the list of channel attribute dictionaries given with *channel_dicts* to create a</span>
<span class="sd">        dictionary of specific `Channel` instances (like e.g. :class:`ChannelShutterContact`)</span>
<span class="sd">        or the generic :class:`Channel` class. Normally each channel should have a specific</span>
<span class="sd">        class. In case an unknown channel needs to be created a debug message is being logged.</span>
<span class="sd">        The dictionary uses the index of the channel (the channel id) as key for entries.</span>

<span class="sd">        The dictionary of the created channels is then returned.&quot;&quot;&quot;</span>
        <span class="n">channel_objects</span> <span class="o">=</span> <span class="n">Channels</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">channel_dict</span> <span class="ow">in</span> <span class="n">channel_dicts</span><span class="p">:</span>
            <span class="n">channel_class</span> <span class="o">=</span> <span class="n">channel_classes_by_type_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">Channel</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">channel_class</span> <span class="o">==</span> <span class="n">Channel</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">cls_logger</span><span class="p">()</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Using generic Channel class (Type: </span><span class="si">%s</span><span class="s2">): </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span>
                                                    <span class="p">(</span><span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">channel_dict</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;INT&quot;</span><span class="p">):</span>
                <span class="c1"># Need to patch missing mandatory attributes for the channel because channels</span>
                <span class="c1"># in virtual devices are missing those</span>
                <span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">][</span><span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
                <span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;link_source_roles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;link_target_roles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="n">channel_objects</span><span class="p">[</span><span class="n">channel_dict</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">channel_class</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">channel_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">channel_objects</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides access to all value objects of this channel.</span>

<span class="sd">        The values are provided as dictionary where the name of the parameter is used as key</span>
<span class="sd">        and some kind of specific :class:`.params.Parameter` instance is the value.&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_init_value_specs</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_update_needed</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fetch_values</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span>


    <span class="k">def</span> <span class="nf">_init_value_specs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s2">&quot;ccu3&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes the value objects by fetching the specification from the CCU.</span>

<span class="sd">        The specification (description) of the VALUES paramset are fetched from</span>
<span class="sd">        the CCU and Parameter() objects will be created from them. Then they</span>
<span class="sd">        will be added to self._values.</span>

<span class="sd">        This method is called on the first access to the values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">_get_target</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;ccu2&quot;</span> <span class="ow">and</span> <span class="n">target</span> <span class="o">!=</span> <span class="s2">&quot;ccu2&quot;</span><span class="p">:</span>
<span class="c1">#            print (&quot;test non CCU2&quot;)</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interface</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;empty interface&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">value_specs</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">interface_get_paramset_description</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="p">,</span>
                                                    <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">paramsetKey</span><span class="o">=</span><span class="s2">&quot;VALUES&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># org defintion</span>
<span class="c1">#            print(&quot;test CCU2 get values&quot;)</span>
            <span class="n">value_specs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">interface_get_paramset_description</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="s2">&quot;BidCos-RF&quot;</span><span class="p">,</span>
                                                    <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">paramsetType</span><span class="o">=</span><span class="s2">&quot;VALUES&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">value_spec</span> <span class="ow">in</span> <span class="n">value_specs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_value_spec</span><span class="p">(</span><span class="n">value_spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_register_saved_callbacks</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_init_value_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initializes a single value of this channel.&quot;&quot;&quot;</span>
        <span class="n">value_id</span> <span class="o">=</span> <span class="n">value_spec</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_class_name_of_param_spec</span><span class="p">(</span><span class="n">value_spec</span><span class="p">)</span>

        <span class="bp">cls</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">pmatic</span><span class="o">.</span><span class="n">params</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">cls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: Skipping unknown parameter </span><span class="si">%s</span><span class="s2"> of type </span><span class="si">%s</span><span class="s2">, unit </span><span class="si">%s</span><span class="s2">. &quot;</span>
                                <span class="s2">&quot;Class </span><span class="si">%s</span><span class="s2"> not implemented.&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_type</span><span class="p">,</span> <span class="n">value_id</span><span class="p">,</span> <span class="n">value_spec</span><span class="p">[</span><span class="s2">&quot;TYPE&quot;</span><span class="p">],</span>
                         <span class="n">value_spec</span><span class="p">[</span><span class="s2">&quot;UNIT&quot;</span><span class="p">],</span> <span class="n">class_name</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">[</span><span class="n">value_id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_spec</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_class_name_of_param_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gathers the name of the class to be used for creating a parameter object</span>
<span class="sd">        from the given parameter specification.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Parameter</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">param_spec</span><span class="p">[</span><span class="s2">&quot;TYPE&quot;</span><span class="p">]</span>


    <span class="k">def</span> <span class="nf">_value_update_needed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tells whether or not the set of values should be fetched from the CCU.&quot;&quot;&quot;</span>
        <span class="n">oldest_value_time</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">last_updated</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">last_updated</span>
                <span class="k">if</span> <span class="n">last_updated</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">last_updated</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># enforce the update</span>
            <span class="k">except</span> <span class="n">PMException</span><span class="p">:</span>
                <span class="k">continue</span> <span class="c1"># Ignore not readable values</span>

            <span class="k">if</span> <span class="n">oldest_value_time</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">oldest_value_time</span> <span class="o">=</span> <span class="n">last_updated</span>
            <span class="k">elif</span> <span class="n">last_updated</span> <span class="o">&lt;</span> <span class="n">oldest_value_time</span><span class="p">:</span>
                <span class="n">oldest_value_time</span> <span class="o">=</span> <span class="n">last_updated</span>

        <span class="k">if</span> <span class="n">oldest_value_time</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span> <span class="c1"># No readable value at all</span>

        <span class="c1"># FIXME: Make threshold configurable</span>
        <span class="k">return</span> <span class="n">oldest_value_time</span> <span class="o">&lt;=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="mi">60</span>


    <span class="k">def</span> <span class="nf">_fetch_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches all values of the channel.</span>

<span class="sd">        Gathers the values of the channel and updates the value parameters in self._values.</span>
<span class="sd">        The parameter objects need to be initialized before (self._init_value_specs).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;The value parameters are not yet initialized.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">PMException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># FIXME: Clean this 601 in &quot;%s&quot; up!</span>
            <span class="k">if</span> <span class="s2">&quot;601&quot;</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">is_online</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">PMDeviceOffline</span><span class="p">(</span><span class="s2">&quot;Failed to fetch the values. The device is not online.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">param_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">param_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="p">[</span><span class="n">param_id</span><span class="p">]</span><span class="o">.</span><span class="n">set_from_api</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">): Skipping received value of unknown parameter </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">param_id</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method returns all values of this channel.</span>

<span class="sd">        Normally it is using the API call Interface.getParamset() to fetch all values of</span>
<span class="sd">        the channel at once. But there are devices which have bugged values which are reported</span>
<span class="sd">        to be readable, but can not be read in fact.</span>

<span class="sd">        The default way to deal with it is to catch the exectpion from the bulk get and then</span>
<span class="sd">        fetch the values one by one, again while catching the exceptions of these calls which</span>
<span class="sd">        which are raised when a value is not readable.</span>

<span class="sd">        In some cases where it is known to be an issue with specific values the channels in</span>
<span class="sd">        question have a specific class which overrides this method to fetch the single values</span>
<span class="sd">        one by one but skips the failing values explicitly.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_bulk</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">PMException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Can not check is_online for maintenance channels here (no values yet)</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">errorcode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">errorcode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;501&quot;</span><span class="p">,</span> <span class="s2">&quot;601&quot;</span><span class="p">])</span> \
               <span class="ow">and</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ChannelMaintenance</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">is_online</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">. Falling back to single value fetching.&quot;</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_single</span><span class="p">(</span><span class="n">skip_invalid_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span>


    <span class="k">def</span> <span class="nf">_get_values_bulk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches all values of this channel at once. This is the default method to</span>
<span class="sd">        fetch the values.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">interface_get_paramset</span><span class="p">(</span><span class="n">interface</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="p">,</span>
                                         <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="n">paramsetKey</span><span class="o">=</span><span class="s2">&quot;VALUES&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_values_single</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_invalid_values</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches all values known to be readable one by one. One should always</span>
<span class="sd">        use :meth:`_get_values_bulked` when possible. This is only used for buggy</span>
<span class="sd">        devices.</span>

<span class="sd">        The function can be called with the `skip_invalid_values` argument set to `True`</span>
<span class="sd">        to only log exceptions of single values and continue with the next value.&quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">param_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">readable</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">values</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">interface_get_value</span><span class="p">(</span>
                                                        <span class="n">interface</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interface</span><span class="p">,</span>
                                                        <span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span>
                                                        <span class="n">valueKey</span><span class="o">=</span><span class="n">value</span><span class="o">.</span><span class="n">internal_name</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">PMException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_invalid_values</span><span class="p">:</span>
                        <span class="k">raise</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">errorcode</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span> <span class="k">for</span> <span class="n">errorcode</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;501&quot;</span><span class="p">,</span> <span class="s2">&quot;601&quot;</span><span class="p">]):</span>
                        <span class="k">raise</span>

                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ChannelMaintenance</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">is_online</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">param_id</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span>
        <span class="k">return</span> <span class="n">values</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Represents a summary state of the channel.</span>

<span class="sd">        Formats values and titles of channel values and returns them as string.</span>

<span class="sd">        Default formating of channel values. Concatenates titles and values of</span>
<span class="sd">        all channel values except the maintenance channel.</span>
<span class="sd">        The values are sorted by the titles.&quot;&quot;&quot;</span>
        <span class="n">formated</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([</span> <span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mylist</span> <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">readable</span> <span class="p">]):</span>
            <span class="n">formated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formated</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_virtual_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;INT&quot;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">set_logic_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used to update the logic attributes of this channel.</span>

<span class="sd">        Applying the attributes in the dictionary to this object. Special handling</span>
<span class="sd">        for some attributes which are already set by the low level attributes.&quot;&quot;&quot;</span>
        <span class="c1">#import pprint</span>
        <span class="c1">#pprint.pprint(self.__dict__)</span>
        <span class="c1">#pprint.pprint(attrs)</span>
        <span class="c1">#sys.exit(1)</span>
        <span class="c1"># Skip non needed attributes (already set by low level data)</span>
        <span class="c1"># FIXME: &#39;direction&#39;: 1, from low level API might be duplicate of</span>
        <span class="c1">#        u&#39;category&#39;: u&#39;CATEGORY_SENDER&#39;,</span>
        <span class="c1"># FIXME: &#39;aes_active&#39;: True, from low level API might be duplicate</span>
        <span class="c1">#        of u&#39;mode&#39;: u&#39;MODE_AES&#39;,</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">[</span> <span class="s2">&quot;address&quot;</span><span class="p">,</span> <span class="s2">&quot;device_id&quot;</span> <span class="p">]:</span>
              <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>

                 <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
            

        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>


<div class="viewcode-block" id="Channel.on_value_changed"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Channel.on_value_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a function to be called each time a value of this channel parameters</span>
<span class="sd">        has changed.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">PMDeviceOffline</span><span class="p">:</span>
            <span class="c1"># Unable to register with parameters right now. Save for later registration</span>
            <span class="c1"># when values are available one day.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_callback_to_register</span><span class="p">(</span><span class="s2">&quot;value_changed&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">value</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="s2">&quot;value_changed&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></div>


<div class="viewcode-block" id="Channel.on_value_updated"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Channel.on_value_updated">[docs]</a>    <span class="k">def</span> <span class="nf">on_value_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a function to be called each time a value of this channel parameters has</span>
<span class="sd">        been updated.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
                <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">except</span> <span class="n">PMDeviceOffline</span><span class="p">:</span>
            <span class="c1"># Unable to register with parameters right now. Save for later registration</span>
            <span class="c1"># when values are available one day.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_callback_to_register</span><span class="p">(</span><span class="s2">&quot;value_updated&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">value</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="s2">&quot;value_updated&quot;</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_save_callback_to_register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cb_name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stores a callback function for attaching it later to the parameters.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbacks_to_register</span><span class="p">[</span><span class="n">cb_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_register_saved_callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If there are saved callbacks to register to new fetched parameters, register them!&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_values</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

        <span class="k">for</span> <span class="n">cb_name</span><span class="p">,</span> <span class="n">callbacks</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_callbacks_to_register</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">callbacks</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">callbacks</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">register_callback</span><span class="p">(</span><span class="n">cb_name</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span></div>



<span class="c1"># FIXME: Implement this. The Device() object already has a lot of methods</span>
<span class="c1"># related to the maintenance channel. Shouldn&#39;t they be moved here and evantually</span>
<span class="c1"># only be available as shortcut in the Device object?</span>
<div class="viewcode-block" id="ChannelMaintenance"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelMaintenance">[docs]</a><span class="k">class</span> <span class="nc">ChannelMaintenance</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;MAINTENANCE&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Maintenance&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The maintenance channel does not provide a summary state.</span>

<span class="sd">        If you want to get a formated maintenance state, you need to use the property</span>
<span class="sd">        :attr:`maintenance_state`.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maintenance_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the formated maintenance state of the associated device.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ChannelMaintenance</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">summary_state</span></div>



<span class="c1"># FIXME: Handle LOWBAT/ERROR</span>
<div class="viewcode-block" id="ChannelShutterContact"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelShutterContact">[docs]</a><span class="k">class</span> <span class="nc">ChannelShutterContact</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;SHUTTER_CONTACT&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_open</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;``True`` when the contact is reported to be open, otherwise ``False``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;STATE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides a well formated state as string. It is ``open`` when the contact</span>
<span class="sd">        is open, otherwise ``closed``.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_open</span> <span class="ow">and</span> <span class="s2">&quot;open&quot;</span> <span class="ow">or</span> <span class="s2">&quot;closed&quot;</span></div>



<span class="c1"># FIXME: Handle STOP, INHIBIT, INSTALL_TEST</span>
<div class="viewcode-block" id="ChannelBlind"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelBlind">[docs]</a><span class="k">class</span> <span class="nc">ChannelBlind</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;BLIND&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look up the level at which the shutter is set.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;LEVEL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

<div class="viewcode-block" id="ChannelBlind.set_level"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelBlind.set_level">[docs]</a>    <span class="k">def</span> <span class="nf">set_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set the level at which the shutter is to be set.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;LEVEL&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">level</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">working</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Look up the WORKING value.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;WORKING&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span></div>



<span class="c1"># FIXME: Handle INHIBIT, WORKING</span>
<div class="viewcode-block" id="ChannelSwitch"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelSwitch">[docs]</a><span class="k">class</span> <span class="nc">ChannelSwitch</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;SWITCH&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;``True`` when the power is on, otherwise ``False``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;STATE&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;STATE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current state as well formated string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="s1">&#39;STATE&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;STATE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_on</span> <span class="ow">and</span> <span class="s2">&quot;on&quot;</span> <span class="ow">or</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;UNKNONW: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">is_on</span> <span class="ow">and</span> <span class="s2">&quot;on&quot;</span> <span class="ow">or</span> <span class="s2">&quot;off&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="ChannelSwitch.toggle"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelSwitch.toggle">[docs]</a>    <span class="k">def</span> <span class="nf">toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Use this to toggle the switch.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_on</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_off</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">switch_on</span><span class="p">()</span></div>


<div class="viewcode-block" id="ChannelSwitch.switch_off"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelSwitch.switch_off">[docs]</a>    <span class="k">def</span> <span class="nf">switch_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Power off!&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;STATE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChannelSwitch.switch_on"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelSwitch.switch_on">[docs]</a>    <span class="k">def</span> <span class="nf">switch_on</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Lights on!&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;STATE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div></div>



<span class="c1"># FIXME: Handle LED_STATUS, ALL_LEDS, LED_SLEEP_MODE, INSTALL_TEST</span>
<div class="viewcode-block" id="ChannelKey"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelKey">[docs]</a><span class="k">class</span> <span class="nc">ChannelKey</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;KEY&quot;</span>

<div class="viewcode-block" id="ChannelKey.press_short"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelKey.press_short">[docs]</a>    <span class="k">def</span> <span class="nf">press_short</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this to trigger a short press.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;PRESS_SHORT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="ChannelKey.press_long"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelKey.press_long">[docs]</a>    <span class="k">def</span> <span class="nf">press_long</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers a long press.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;PRESS_LONG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="c1"># Not verified working</span>
<div class="viewcode-block" id="ChannelKey.press_long_release"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelKey.press_long_release">[docs]</a>    <span class="k">def</span> <span class="nf">press_long_release</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Triggers the release of a long press.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;PRESS_LONG_RELEASE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="c1"># Not verified</span>
<div class="viewcode-block" id="ChannelKey.press_cont"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelKey.press_cont">[docs]</a>    <span class="k">def</span> <span class="nf">press_cont</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Unknown. Untested. Please let me know what this is.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;PRESS_CONT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Has no state info as it&#39;s a toggle button. This is only to override the</span>
<span class="sd">        default summary_state property.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="ChannelVirtualKey"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelVirtualKey">[docs]</a><span class="k">class</span> <span class="nc">ChannelVirtualKey</span><span class="p">(</span><span class="n">ChannelKey</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;VIRTUAL_KEY&quot;</span></div>



<span class="c1"># FIXME: Handle all values:</span>
<span class="c1"># {u&#39;POWER&#39;: u&#39;3.520000&#39;, u&#39;ENERGY_COUNTER&#39;: u&#39;501.400000&#39;, u&#39;BOOT&#39;: u&#39;1&#39;,</span>
<span class="c1">#  u&#39;CURRENT&#39;: u&#39;26.000000&#39;, u&#39;FREQUENCY&#39;: u&#39;50.010000&#39;, u&#39;VOLTAGE&#39;: u&#39;228.900000&#39;}</span>
<div class="viewcode-block" id="ChannelPowermeter"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelPowermeter">[docs]</a><span class="k">class</span> <span class="nc">ChannelPowermeter</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;POWERMETER&quot;</span></div>


<span class="c1"># FIXME: To be implemented.</span>
<div class="viewcode-block" id="ChannelConditionPower"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelConditionPower">[docs]</a><span class="k">class</span> <span class="nc">ChannelConditionPower</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CONDITION_POWER&quot;</span></div>


<span class="c1"># FIXME: To be implemented.</span>
<div class="viewcode-block" id="ChannelConditionCurrent"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelConditionCurrent">[docs]</a><span class="k">class</span> <span class="nc">ChannelConditionCurrent</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CONDITION_CURRENT&quot;</span></div>


<span class="c1"># FIXME: To be implemented.</span>
<div class="viewcode-block" id="ChannelConditionVoltage"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelConditionVoltage">[docs]</a><span class="k">class</span> <span class="nc">ChannelConditionVoltage</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CONDITION_VOLTAGE&quot;</span></div>



<span class="c1"># FIXME: To be implemented.</span>
<div class="viewcode-block" id="ChannelConditionFrequency"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelConditionFrequency">[docs]</a><span class="k">class</span> <span class="nc">ChannelConditionFrequency</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CONDITION_FREQUENCY&quot;</span></div>



<span class="c1"># FIXME: To be implemented.</span>
<span class="c1"># Devices:</span>
<span class="c1">#   HM-Sen-LI-O</span>
<span class="k">class</span> <span class="nc">ChannelLuxmeter</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;LUXMETER&quot;</span>


<span class="c1"># FIXME: To be implemented.</span>
<span class="c1"># Devices:</span>
<span class="c1">#   HM-WDS10-TH-O</span>
<div class="viewcode-block" id="ChannelWeather"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelWeather">[docs]</a><span class="k">class</span> <span class="nc">ChannelWeather</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;WEATHER&quot;</span></div>



<span class="c1"># FIXME: Handle ERROR</span>
<div class="viewcode-block" id="ChannelClimaVentDrive"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelClimaVentDrive">[docs]</a><span class="k">class</span> <span class="nc">ChannelClimaVentDrive</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CLIMATECONTROL_VENT_DRIVE&quot;</span></div>



<span class="c1"># FIXME: Handle ADJUSTING_COMMAND, ADJUSTING_DATA</span>
<div class="viewcode-block" id="ChannelClimaRegulator"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelClimaRegulator">[docs]</a><span class="k">class</span> <span class="nc">ChannelClimaRegulator</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CLIMATECONTROL_REGULATOR&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the ventil state.&quot;&quot;&quot;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SETPOINT&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Ventil closed&quot;</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">==</span> <span class="mf">100.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Ventil open&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Ventil: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SETPOINT&quot;</span><span class="p">]</span></div>


<span class="c1"># Devices:</span>
<span class="c1">#  HM-CC-RT-DN</span>
<span class="c1"># FIXME: Values:</span>
<span class="c1"># {u&#39;SET_TEMPERATURE&#39;: u&#39;21.500000&#39;, u&#39;PARTY_START_MONTH&#39;: u&#39;1&#39;, u&#39;BATTERY_STATE&#39;: u&#39;2.400000&#39;,</span>
<span class="c1">#  u&#39;PARTY_START_DAY&#39;: u&#39;1&#39;, u&#39;PARTY_STOP_DAY&#39;: u&#39;1&#39;, u&#39;PARTY_START_YEAR&#39;: u&#39;0&#39;,</span>
<span class="c1">#  u&#39;FAULT_REPORTING&#39;: u&#39;0&#39;, u&#39;PARTY_STOP_TIME&#39;: u&#39;0&#39;, u&#39;ACTUAL_TEMPERATURE&#39;: u&#39;23.100000&#39;,</span>
<span class="c1">#  u&#39;BOOST_STATE&#39;: u&#39;15&#39;, u&#39;PARTY_STOP_YEAR&#39;: u&#39;0&#39;, u&#39;PARTY_STOP_MONTH&#39;: u&#39;1&#39;,</span>
<span class="c1">#  u&#39;VALVE_STATE&#39;: u&#39;10&#39;, u&#39;PARTY_START_TIME&#39;: u&#39;450&#39;, u&#39;PARTY_TEMPERATURE&#39;: u&#39;5.000000&#39;,</span>
<span class="c1">#  u&#39;CONTROL_MODE&#39;: u&#39;1&#39;}</span>
<div class="viewcode-block" id="ChannelClimaRTTransceiver"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelClimaRTTransceiver">[docs]</a><span class="k">class</span> <span class="nc">ChannelClimaRTTransceiver</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CLIMATECONTROL_RT_TRANSCEIVER&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the actual and target temperature together with the valve state in</span>
<span class="sd">        some readable format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Temperature: </span><span class="si">%s</span><span class="s2"> (Target: </span><span class="si">%s</span><span class="s2">, Valve: </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ACTUAL_TEMPERATURE&quot;</span><span class="p">],</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SET_TEMPERATURE&quot;</span><span class="p">],</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;VALVE_STATE&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;VALVE_STATE&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="k">else</span> <span class="s2">&quot;NA&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_class_name_of_param_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_spec</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">param_spec</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CONTROL_MODE&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;ParameterControlMode&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">ChannelClimaRTTransceiver</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_class_name_of_param_spec</span><span class="p">(</span><span class="n">param_spec</span><span class="p">)</span></div>



<div class="viewcode-block" id="ChannelWindowSwitchReceiver"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelWindowSwitchReceiver">[docs]</a><span class="k">class</span> <span class="nc">ChannelWindowSwitchReceiver</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;WINDOW_SWITCH_RECEIVER&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides ``None`` since the channel has not any values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="ChannelWeatherReceiver"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelWeatherReceiver">[docs]</a><span class="k">class</span> <span class="nc">ChannelWeatherReceiver</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;WEATHER_RECEIVER&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides ``None`` since the channel has not any values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># Devices:</span>
<span class="c1">#  HM-CC-RT-DN</span>
<div class="viewcode-block" id="ChannelClimateControlReceiver"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelClimateControlReceiver">[docs]</a><span class="k">class</span> <span class="nc">ChannelClimateControlReceiver</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CLIMATECONTROL_RECEIVER&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides ``None`` since the channel has not any values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># Devices:</span>
<span class="c1">#  HM-CC-RT-DN</span>
<div class="viewcode-block" id="ChannelClimateControlRTReceiver"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelClimateControlRTReceiver">[docs]</a><span class="k">class</span> <span class="nc">ChannelClimateControlRTReceiver</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;CLIMATECONTROL_RT_RECEIVER&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides ``None`` since the channel has not any values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># Devices:</span>
<span class="c1">#  HM-CC-RT-DN</span>
<div class="viewcode-block" id="ChannelRemoteControlReceiver"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelRemoteControlReceiver">[docs]</a><span class="k">class</span> <span class="nc">ChannelRemoteControlReceiver</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;REMOTECONTROL_RECEIVER&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides ``None`` since the channel has not any values&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<span class="c1"># Devices:</span>
<span class="c1">#  HM-TC-IT-WM-W-EU</span>
<div class="viewcode-block" id="ChannelWeatherTransmit"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelWeatherTransmit">[docs]</a><span class="k">class</span> <span class="nc">ChannelWeatherTransmit</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;WEATHER_TRANSMIT&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the temperature and humidity in readable format.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;Temperature: </span><span class="si">%s</span><span class="s2">, Humidity: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;TEMPERATURE&quot;</span><span class="p">],</span>
                 <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;HUMIDITY&quot;</span><span class="p">])</span></div>


<span class="c1"># Devices:</span>
<span class="c1">#  HM-TC-IT-WM-W-EU</span>
<div class="viewcode-block" id="ChannelThermalControlTransmit"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelThermalControlTransmit">[docs]</a><span class="k">class</span> <span class="nc">ChannelThermalControlTransmit</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;THERMALCONTROL_TRANSMIT&quot;</span>

    <span class="k">def</span> <span class="nf">_init_value_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_spec</span><span class="p">):</span>
        <span class="c1"># The value PARTY_MODE_SUBMIT seems to be declared to be readable by</span>
        <span class="c1"># the CCU which is wrong. This value can not be read.</span>
        <span class="c1"># See &lt;https://github.com/LarsMichelsen/pmatic/issues/7&gt;.</span>
        <span class="k">if</span> <span class="n">value_spec</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;PARTY_MODE_SUBMIT&quot;</span><span class="p">:</span>
            <span class="n">value_spec</span><span class="p">[</span><span class="s2">&quot;OPERATIONS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;2&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ChannelThermalControlTransmit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_init_value_spec</span><span class="p">(</span><span class="n">value_spec</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is needed to not let the CCU decide which values to be read from</span>
        <span class="c1"># the device because of the bug mentioned above.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_single</span><span class="p">()</span></div>



<span class="c1"># Devices:</span>
<span class="c1">#  HM-TC-IT-WM-W-EU</span>
<div class="viewcode-block" id="ChannelSwitchTransmit"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.ChannelSwitchTransmit">[docs]</a><span class="k">class</span> <span class="nc">ChannelSwitchTransmit</span><span class="p">(</span><span class="n">Channel</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;SWITCH_TRANSMIT&quot;</span>

    <span class="k">def</span> <span class="nf">_init_value_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value_spec</span><span class="p">):</span>
        <span class="c1"># The value SWITCH_TRANSMIT seems to be declared to be readable by</span>
        <span class="c1"># the CCU which is wrong. This value can not be read.</span>
        <span class="c1"># See &lt;https://github.com/LarsMichelsen/pmatic/issues/7&gt;.</span>
        <span class="k">if</span> <span class="n">value_spec</span><span class="p">[</span><span class="s2">&quot;ID&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;DECISION_VALUE&quot;</span><span class="p">:</span>
            <span class="n">value_spec</span><span class="p">[</span><span class="s2">&quot;OPERATIONS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;4&quot;</span> <span class="c1"># only supports events</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ChannelSwitchTransmit</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_init_value_spec</span><span class="p">(</span><span class="n">value_spec</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This is needed to not let the CCU decide which values to be read from</span>
        <span class="c1"># the device because of the bug mentioned above.</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_values_single</span><span class="p">()</span></div>



<div class="viewcode-block" id="Devices"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices">[docs]</a><span class="k">class</span> <span class="nc">Devices</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Manages a collection of CCU devices.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccu</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Devices</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ccu</span><span class="p">,</span> <span class="n">pmatic</span><span class="o">.</span><span class="n">ccu</span><span class="o">.</span><span class="n">CCU</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;Invalid ccu object provided: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ccu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span> <span class="o">=</span> <span class="n">ccu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_device_dict</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Optional initializer of the devices data structure, called on first access.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_device_dict</span>


<div class="viewcode-block" id="Devices.get"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">deflt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the device matching the given device address.</span>

<span class="sd">        If there is none matching the given address either None or the value</span>
<span class="sd">        specified by the optional attribute *deflt* is returned.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">deflt</span><span class="p">)</span></div>


<div class="viewcode-block" id="Devices.add"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a :class:`.Device` object to the collection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">Device</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;You can only add device objects.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="p">[</span><span class="n">device</span><span class="o">.</span><span class="n">address</span><span class="p">]</span> <span class="o">=</span> <span class="n">device</span></div>


<div class="viewcode-block" id="Devices.exists"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether or not a device with the given address is in this collection.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">address</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span></div>


<div class="viewcode-block" id="Devices.addresses"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.addresses">[docs]</a>    <span class="k">def</span> <span class="nf">addresses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of all addresses of all initialized devices.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>


<div class="viewcode-block" id="Devices.delete"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the device with the given address from the pmatic runtime.</span>

<span class="sd">        The device is not deleted from the CCU.</span>
<span class="sd">        When the device is not known, the method is tollerating that.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="p">[</span><span class="n">address</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="Devices.clear"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all objects from this devices collection.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<div class="viewcode-block" id="Devices.get_device_or_channel_by_address"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.get_device_or_channel_by_address">[docs]</a>    <span class="k">def</span> <span class="nf">get_device_or_channel_by_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the device or channel object of the given address.</span>

<span class="sd">        Raises a KeyError exception when no device exists for this</span>
<span class="sd">        address in the already fetched objects.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">address</span><span class="p">:</span>
            <span class="n">device_address</span> <span class="o">=</span> <span class="n">address</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">channeldevice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="p">[</span><span class="n">device_address</span><span class="p">]</span><span class="o">.</span><span class="n">channel_by_address</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">channeldevice</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="p">[</span><span class="n">address</span><span class="p">]</span></div>


<div class="viewcode-block" id="Devices.on_value_changed"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.on_value_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a function to be called each time a value of a device in this</span>
<span class="sd">        collection changed.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="n">device</span><span class="o">.</span><span class="n">on_value_changed</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>


<div class="viewcode-block" id="Devices.on_value_updated"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.on_value_updated">[docs]</a>    <span class="k">def</span> <span class="nf">on_value_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a function to be called each time a value of a device in this</span>
<span class="sd">        collection updated.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="n">device</span><span class="o">.</span><span class="n">on_value_updated</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>


<div class="viewcode-block" id="Devices.__iter__"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.__iter__">[docs]</a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides an iterator over the devices of this collection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Devices.__len__"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Devices.__len__">[docs]</a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is e.g. used by :func:`len`. Returns the number of devices in this collection.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="p">)</span></div></div>



<span class="c1"># FIXME: self.channels[0]: Provide better access to the channels. e.g. by names or ids or similar</span>
<div class="viewcode-block" id="Device"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Device">[docs]</a><span class="k">class</span> <span class="nc">Device</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
    <span class="n">_transform_attributes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1"># ReGa attributes:</span>
        <span class="c1">#&quot;id&quot;                : int,</span>
        <span class="c1">#&quot;deviceId&quot;          : int,</span>
        <span class="c1">#&quot;operateGroupOnly&quot;  : lambda v: v != &quot;false&quot;,</span>

        <span class="c1"># Low level attributes:</span>
        <span class="s2">&quot;flags&quot;</span>             <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;roaming&quot;</span>           <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="s2">&quot;updateable&quot;</span>        <span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="s2">&quot;channels&quot;</span>          <span class="p">:</span> <span class="n">Channel</span><span class="o">.</span><span class="n">from_channel_dicts</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># Don&#39;t add these keys to the objects attributes</span>
    <span class="n">_skip_attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Low level attributes:</span>
        <span class="s2">&quot;children&quot;</span><span class="p">,</span> <span class="c1"># not needed</span>
        <span class="s2">&quot;parent&quot;</span><span class="p">,</span> <span class="c1"># not needed</span>
        <span class="s2">&quot;rf_address&quot;</span><span class="p">,</span> <span class="c1"># not available through XML-RPC and API, so exclude at all</span>
        <span class="s2">&quot;rx_mode&quot;</span><span class="p">,</span> <span class="c1"># not available through XML-RPC and API, so exclude at all</span>
    <span class="p">]</span>

    <span class="c1"># These keys have to be set after attribute initialization</span>
    <span class="n">_mandatory_attributes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># Low level attributes:</span>

        <span class="c1"># Address of the device</span>
        <span class="s2">&quot;address&quot;</span><span class="p">,</span>
        <span class="c1"># Firmware version string</span>
        <span class="s2">&quot;firmware&quot;</span><span class="p">,</span>
        <span class="c1"># 0x01: show to user, 0x02 hide from user, 0x08 can not be deleted</span>
        <span class="s2">&quot;flags&quot;</span><span class="p">,</span>
        <span class="c1"># serial number of the device</span>
        <span class="s2">&quot;interface&quot;</span><span class="p">,</span>
        <span class="c1"># true when the device assignment is automatically adjusted</span>
        <span class="s2">&quot;roaming&quot;</span><span class="p">,</span>
        <span class="c1"># device type</span>
        <span class="s2">&quot;type&quot;</span><span class="p">,</span>
        <span class="c1"># true when an update is available</span>
        <span class="s2">&quot;updatable&quot;</span><span class="p">,</span>
        <span class="c1"># version of the device description</span>
        <span class="s2">&quot;version&quot;</span><span class="p">,</span>
        <span class="c1"># list of channel objects</span>
        <span class="s2">&quot;channels&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Device</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>


<div class="viewcode-block" id="Device.from_dict"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Device.from_dict">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a new device object from the attributes given in the *spec* dictionary.</span>

<span class="sd">        The *spec* dictionary needs to contain the mandatory attributes with values of the correct</span>
<span class="sd">        format. Depending on the device type specified by the *spec* dictionary, either a specific</span>
<span class="sd">        device class or the generic :class:`Device` class is used to create the object.&quot;&quot;&quot;</span>
        <span class="n">device_class</span> <span class="o">=</span> <span class="n">device_classes_by_type_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">spec</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span> <span class="n">Device</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">device_class</span><span class="p">(</span><span class="n">ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


    <span class="c1"># {u&#39;UNREACH&#39;: u&#39;1&#39;, u&#39;AES_KEY&#39;: u&#39;1&#39;, u&#39;UPDATE_PENDING&#39;: u&#39;1&#39;, u&#39;RSSI_PEER&#39;: u&#39;-65535&#39;,</span>
    <span class="c1">#  u&#39;LOWBAT&#39;: u&#39;0&#39;, u&#39;STICKY_UNREACH&#39;: u&#39;1&#39;, u&#39;DEVICE_IN_BOOTLOADER&#39;: u&#39;0&#39;,</span>
    <span class="c1">#  u&#39;CONFIG_PENDING&#39;: u&#39;0&#39;, u&#39;RSSI_DEVICE&#39;: u&#39;-65535&#39;, u&#39;DUTYCYCLE&#39;: u&#39;0&#39;}</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">maintenance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the :class:`ChannelMaintenance` object of this device. It provides</span>
<span class="sd">        access to generic maintenance information available on this device.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


<div class="viewcode-block" id="Device.set_logic_attributes"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Device.set_logic_attributes">[docs]</a>    <span class="k">def</span> <span class="nf">set_logic_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Used to update the logic attributes of this device.</span>

<span class="sd">        Applying the attributes in the dictionary to this object. Special handling</span>
<span class="sd">        for some attributes which are already set by the low level attributes and</span>
<span class="sd">        for the channel attributes which are also part of attrs.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">channel_attrs</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="n">channel_attrs</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">set_logic_attributes</span><span class="p">(</span><span class="n">channel_attrs</span><span class="p">)</span>

        <span class="c1"># Skip non needed attributes (already set by low level data)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;channels&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;address&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;interface&quot;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_attributes</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_online</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is ``True`` when the device is currently reachable. Otherwise it is ``False``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;HM-RCV-50&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span> <span class="c1"># CCU is always assumed to be online</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;UNREACH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_battery_low</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is ``True`` when the battery is reported to be low.</span>

<span class="sd">        When the battery is in normal state, it is ``False``. It might be a</span>
<span class="sd">        non battery powered device, then it is ``None``.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;LOWBAT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span> <span class="c1"># not battery powered</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_pending_config</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is ``True`` when the CCU has pending configuration changes for this device.</span>
<span class="sd">        Otherwise it is ``False``.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;HM-RCV-50&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;CONFIG_PENDING&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;CONFIG_PENDING&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_pending_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is ``True`` when the CCU has a pending firmware update for this device.</span>
<span class="sd">        Otherwise it is ``False``.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;UPDATE_PENDING&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">rssi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is a two element tuple of the devices current RSSI (Received Signal Strength Indication).</span>

<span class="sd">        The first element is the devices RSSI, the second one the CCUs RSSI.</span>

<span class="sd">        In case of the CCU itself or a non radio device it is set to ``(None, None)``.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;RSSI_DEVICE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> \
                   <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;RSSI_PEER&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>


    <span class="c1">#{u&#39;CONTROL&#39;: u&#39;NONE&#39;, u&#39;OPERATIONS&#39;: u&#39;7&#39;, u&#39;NAME&#39;: u&#39;INHIBIT&#39;, u&#39;MIN&#39;: u&#39;0&#39;,</span>
    <span class="c1"># u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;1&#39;, u&#39;TAB_ORDER&#39;: u&#39;6&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;BOOL&#39;,</span>
    <span class="c1"># u&#39;ID&#39;: u&#39;INHIBIT&#39;, u&#39;UNIT&#39;: u&#39;&#39;}</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">inhibit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual inhibit state of the device.</span>

<span class="sd">        :getter: Whether or not the device is currently locked, provided as</span>
<span class="sd">                 :class:`params.ParameterBOOL`.</span>
<span class="sd">        :setter: Specify the new inhibit state as boolean.</span>
<span class="sd">        :type: :class:`params.ParameterBOOL`/bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;INHIBIT&quot;</span><span class="p">]</span>


    <span class="nd">@inhibit</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">inhibit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maintenance</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;INHIBIT&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">state</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides a textual summary state of the device.</span>

<span class="sd">        Gives you a string representing some kind of summary state of the device. This</span>
<span class="sd">        string does not necessarly contain all state information of the devices.</span>

<span class="sd">        When a device is unreachable, it does only contain this information.</span>

<span class="sd">        This default method concatenates values and titles of channel values and</span>
<span class="sd">        provides them as string. The values are sorted by the titles.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_summary_state</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">_get_summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">skip_channel_types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Internal helper for :prop:`summary_state`.</span>

<span class="sd">        It is possible to exclude the states of specific channels by listing the</span>
<span class="sd">        names of the channel classes in the optional *skip_channel_types* argument.&quot;&quot;&quot;</span>
        <span class="n">formated</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_online</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;The device is unreachable&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_battery_low</span><span class="p">:</span>
            <span class="n">formated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;The battery is low&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_pending_config</span><span class="p">:</span>
            <span class="n">formated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Config pending&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_pending_update</span><span class="p">:</span>
            <span class="n">formated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Update pending&quot;</span><span class="p">)</span>

        <span class="c1"># FIXME: Add bad rssi?</span>

        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">skip_channel_types</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">skip_channel_types</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">summary_state</span>
                <span class="k">if</span> <span class="n">txt</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">formated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">formated</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">formated</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;Device reports no operational state&quot;</span>


<div class="viewcode-block" id="Device.channel_by_address"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Device.channel_by_address">[docs]</a>    <span class="k">def</span> <span class="nf">channel_by_address</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the channel object having the requested address.</span>

<span class="sd">        When the device has no such channel, a KeyError() is raised.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">address</span> <span class="o">==</span> <span class="n">channel</span><span class="o">.</span><span class="n">address</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">channel</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">&quot;The channel could not be found on this device.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="Device.on_value_changed"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Device.on_value_changed">[docs]</a>    <span class="k">def</span> <span class="nf">on_value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a function to be called each time a value of this device has changed.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">on_value_changed</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div>


<div class="viewcode-block" id="Device.on_value_updated"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Device.on_value_updated">[docs]</a>    <span class="k">def</span> <span class="nf">on_value_updated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Register a function to be called each time a value of this device has updated.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">on_value_updated</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></div></div>



<span class="c1"># Funk-Heizkörperthermostat</span>
<span class="c1"># TODO:</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;NONE&#39;, u&#39;OPERATIONS&#39;: u&#39;5&#39;, u&#39;NAME&#39;: u&#39;FAULT_REPORTING&#39;, u&#39;MIN&#39;: u&#39;0&#39;,</span>
<span class="c1"># u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;7&#39;, u&#39;VALUE_LIST&#39;: u&#39;NO_FAULT VALVE_TIGHT</span>
<span class="c1"># ADJUSTING_RANGE_TOO_LARGE ADJUSTING_RANGE_TOO_SMALL COMMUNICATION_ERROR {}</span>
<span class="c1"># LOWBAT VALVE_ERROR_POSITION&#39;, u&#39;TAB_ORDER&#39;: u&#39;1&#39;, u&#39;FLAGS&#39;: u&#39;9&#39;,</span>
<span class="c1"># u&#39;TYPE&#39;: u&#39;ENUM&#39;, u&#39;ID&#39;: u&#39;FAULT_REPORTING&#39;, u&#39;UNIT&#39;: u&#39;&#39;}</span>

<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_TEMP&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;, u&#39;NAME&#39;: u&#39;PARTY_TEMPERATURE&#39;,</span>
<span class="c1"># u&#39;MIN&#39;: u&#39;5.000000&#39;, u&#39;DEFAULT&#39;: u&#39;20.000000&#39;, u&#39;MAX&#39;: u&#39;30.000000&#39;, u&#39;TAB_ORDER&#39;: u&#39;13&#39;,</span>
<span class="c1"># u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;FLOAT&#39;, u&#39;ID&#39;: u&#39;PARTY_TEMPERATURE&#39;, u&#39;UNIT&#39;: u&#39;\xb0C&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;NONE&#39;, u&#39;OPERATIONS&#39;: u&#39;2&#39;, u&#39;NAME&#39;: u&#39;PARTY_MODE_SUBMIT&#39;, u&#39;MIN&#39;: u&#39;&#39;,</span>
<span class="c1"># u&#39;DEFAULT&#39;: u&#39;&#39;, u&#39;MAX&#39;: u&#39;&#39;, u&#39;TAB_ORDER&#39;: u&#39;12&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;STRING&#39;,</span>
<span class="c1"># u&#39;ID&#39;: u&#39;PARTY_MODE_SUBMIT&#39;, u&#39;UNIT&#39;: u&#39;&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_START_TIME&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;,</span>
<span class="c1"># u&#39;NAME&#39;: u&#39;PARTY_START_TIME&#39;, u&#39;MIN&#39;: u&#39;0&#39;, u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;1410&#39;,</span>
<span class="c1"># u&#39;TAB_ORDER&#39;: u&#39;14&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;PARTY_START_TIME&#39;,</span>
<span class="c1"># u&#39;UNIT&#39;: u&#39;minutes&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_START_DAY&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;, u&#39;NAME&#39;: u&#39;PARTY_START_DAY&#39;,</span>
<span class="c1"># u&#39;MIN&#39;: u&#39;1&#39;, u&#39;DEFAULT&#39;: u&#39;1&#39;, u&#39;MAX&#39;: u&#39;31&#39;, u&#39;TAB_ORDER&#39;: u&#39;15&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;,</span>
<span class="c1"># u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;PARTY_START_DAY&#39;, u&#39;UNIT&#39;: u&#39;day&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_START_MONTH&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;,</span>
<span class="c1"># u&#39;NAME&#39;: u&#39;PARTY_START_MONTH&#39;, u&#39;MIN&#39;: u&#39;1&#39;, u&#39;DEFAULT&#39;: u&#39;1&#39;, u&#39;MAX&#39;: u&#39;12&#39;,</span>
<span class="c1"># u&#39;TAB_ORDER&#39;: u&#39;16&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;:</span>
<span class="c1"># u&#39;PARTY_START_MONTH&#39;, u&#39;UNIT&#39;: u&#39;month&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_START_YEAR&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;,</span>
<span class="c1"># u&#39;NAME&#39;: u&#39;PARTY_START_YEAR&#39;, u&#39;MIN&#39;: u&#39;0&#39;, u&#39;DEFAULT&#39;: u&#39;12&#39;, u&#39;MAX&#39;: u&#39;99&#39;,</span>
<span class="c1"># u&#39;TAB_ORDER&#39;: u&#39;17&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;PARTY_START_YEAR&#39;,</span>
<span class="c1"># u&#39;UNIT&#39;: u&#39;year&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_STOP_TIME&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;,</span>
<span class="c1"># u&#39;NAME&#39;: u&#39;PARTY_STOP_TIME&#39;, u&#39;MIN&#39;: u&#39;0&#39;, u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;1410&#39;,</span>
<span class="c1"># u&#39;TAB_ORDER&#39;: u&#39;18&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;PARTY_STOP_TIME&#39;,</span>
<span class="c1"># u&#39;UNIT&#39;: u&#39;minutes&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_STOP_DAY&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;, u&#39;NAME&#39;: u&#39;PARTY_STOP_DAY&#39;,</span>
<span class="c1"># u&#39;MIN&#39;: u&#39;1&#39;, u&#39;DEFAULT&#39;: u&#39;1&#39;, u&#39;MAX&#39;: u&#39;31&#39;, u&#39;TAB_ORDER&#39;: u&#39;19&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;,</span>
<span class="c1"># u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;PARTY_STOP_DAY&#39;, u&#39;UNIT&#39;: u&#39;day&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_STOP_MONTH&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;, u&#39;NAME&#39;: u&#39;PARTY_STOP_MONTH&#39;,</span>
<span class="c1"># u&#39;MIN&#39;: u&#39;1&#39;, u&#39;DEFAULT&#39;: u&#39;1&#39;, u&#39;MAX&#39;: u&#39;12&#39;, u&#39;TAB_ORDER&#39;: u&#39;20&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;,</span>
<span class="c1"># u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;PARTY_STOP_MONTH&#39;, u&#39;UNIT&#39;: u&#39;month&#39;}</span>
<span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.PARTY_STOP_YEAR&#39;, u&#39;OPERATIONS&#39;: u&#39;3&#39;, u&#39;NAME&#39;: u&#39;PARTY_STOP_YEAR&#39;,</span>
<span class="c1"># u&#39;MIN&#39;: u&#39;0&#39;, u&#39;DEFAULT&#39;: u&#39;12&#39;, u&#39;MAX&#39;: u&#39;99&#39;, u&#39;TAB_ORDER&#39;: u&#39;21&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;,</span>
<span class="c1"># u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;PARTY_STOP_YEAR&#39;, u&#39;UNIT&#39;: u&#39;year&#39;}</span>
<div class="viewcode-block" id="HM_CC_RT_DN"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_CC_RT_DN">[docs]</a><span class="k">class</span> <span class="nc">HM_CC_RT_DN</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-CC-RT-DN&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current temperature.</span>

<span class="sd">        Returns an instance of :class:`ParameterFLOAT`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ACTUAL_TEMPERATURE&quot;</span><span class="p">]</span>


    <span class="c1">#{u&#39;CONTROL&#39;: u&#39;NONE&#39;, u&#39;OPERATIONS&#39;: u&#39;5&#39;, u&#39;NAME&#39;: u&#39;VALVE_STATE&#39;, u&#39;MIN&#39;: u&#39;0&#39;,</span>
    <span class="c1"># u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;99&#39;, u&#39;TAB_ORDER&#39;: u&#39;3&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;INTEGER&#39;,</span>
    <span class="c1"># u&#39;ID&#39;: u&#39;VALVE_STATE&#39;, u&#39;UNIT&#39;: u&#39;%&#39;}</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">valve_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current valve state in percentage.</span>

<span class="sd">        Returns an instance of :class:`ParameterINTEGER`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;VALVE_STATE&quot;</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">set_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual set temperature of the device.</span>

<span class="sd">        :getter: Provides the actual target temperature as :class:`ParameterFLOAT`.</span>
<span class="sd">        :setter: Specify the new set temperature as float. Please note that the CCU rounds</span>
<span class="sd">                 this values to</span>
<span class="sd">                 .0 or .5 after the comma. So if you provide .e.g 22.1 as new set temperature,</span>
<span class="sd">                 the CCU will convert this to 22.0. This is totally equal to the control on the</span>
<span class="sd">                 device.</span>
<span class="sd">        :type: ParameterFloat/float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SET_TEMPERATURE&quot;</span><span class="p">]</span>


    <span class="nd">@set_temperature</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SET_TEMPERATURE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">target</span>


    <span class="c1"># {u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.COMFORT&#39;, u&#39;OPERATIONS&#39;: u&#39;2&#39;, u&#39;NAME&#39;: u&#39;COMFORT_MODE&#39;,</span>
    <span class="c1">#  u&#39;MIN&#39;: u&#39;0&#39;, u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;1&#39;, u&#39;TAB_ORDER&#39;: u&#39;10&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;,</span>
    <span class="c1">#  u&#39;TYPE&#39;: u&#39;ACTION&#39;, u&#39;ID&#39;: u&#39;COMFORT_MODE&#39;, u&#39;UNIT&#39;: u&#39;&#39;}</span>
<div class="viewcode-block" id="HM_CC_RT_DN.set_temperature_comfort"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_CC_RT_DN.set_temperature_comfort">[docs]</a>    <span class="k">def</span> <span class="nf">set_temperature_comfort</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the :attr:`set_temperature` to the configured comfort temperature&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;COMFORT_MODE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span></div>


    <span class="c1">#{u&#39;CONTROL&#39;: u&#39;HEATING_CONTROL.LOWERING&#39;, u&#39;OPERATIONS&#39;: u&#39;2&#39;, u&#39;NAME&#39;: u&#39;LOWERING_MODE&#39;,</span>
    <span class="c1"># u&#39;MIN&#39;: u&#39;0&#39;, u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;1&#39;, u&#39;TAB_ORDER&#39;: u&#39;11&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;,</span>
    <span class="c1"># u&#39;TYPE&#39;: u&#39;ACTION&#39;, u&#39;ID&#39;: u&#39;LOWERING_MODE&#39;, u&#39;UNIT&#39;: u&#39;&#39;}</span>
<div class="viewcode-block" id="HM_CC_RT_DN.set_temperature_lowering"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_CC_RT_DN.set_temperature_lowering">[docs]</a>    <span class="k">def</span> <span class="nf">set_temperature_lowering</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets the :attr:`set_temperature` to the configured lowering temperature&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;LOWERING_MODE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">True</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is set to `True` when the device is not enabled to heat.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SET_TEMPERATURE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mf">4.5</span>


<div class="viewcode-block" id="HM_CC_RT_DN.turn_off"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_CC_RT_DN.turn_off">[docs]</a>    <span class="k">def</span> <span class="nf">turn_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this method to tell the thermostat that it should not heat.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_temperature</span> <span class="o">=</span> <span class="mf">4.5</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The actual control mode of the device. This is either ``AUTO``, ``MANUAL``,</span>
<span class="sd">        ``PARTY`` or ``BOOST``.</span>

<span class="sd">        :getter: Provides the current control mode as :class:`ParameterENUM`.</span>
<span class="sd">        :setter: Set the control mode by the name of the mode (see above). When setting</span>
<span class="sd">                 to ``MANUAL`` it uses either the current set temperature as target</span>
<span class="sd">                 temperature or the default temperature when the</span>
<span class="sd">                 device is currently turned off.</span>
<span class="sd">        :type: ParameterENUM/string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;CONTROL_MODE&quot;</span><span class="p">]</span>


    <span class="nd">@control_mode</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">control_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
        <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;AUTO&quot;</span><span class="p">,</span> <span class="s2">&quot;MANUAL&quot;</span><span class="p">,</span> <span class="s2">&quot;PARTY&quot;</span><span class="p">,</span> <span class="s2">&quot;BOOST&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;The control mode must be one of: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modes</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;MANUAL&quot;</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;MANU&quot;</span>

        <span class="n">value</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># In manual mode the set temperature needs to be provided. Set it to the</span>
        <span class="c1"># current set temperature. When the set temperature is &quot;off&quot;, use the default</span>
        <span class="c1"># value.</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;MANU&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_off</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_temperature</span><span class="o">.</span><span class="n">default</span>
                <span class="c1"># Also set the set_temperature attribute</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_temperature</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_temperature</span><span class="o">.</span><span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">_MODE&quot;</span> <span class="o">%</span> <span class="n">mode</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_battery_low</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is ``True`` when the battery is reported to be low, otherwise ``False``.</span>
<span class="sd">        If you want more details about the current battery, use :meth:`battery_state` to get</span>
<span class="sd">        the current reported voltage.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;FAULT_REPORTING&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">formated</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;LOWBAT&quot;</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">battery_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the actual battery voltage reported by the device.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;BATTERY_STATE&quot;</span><span class="p">]</span>


    <span class="c1"># {u&#39;CONTROL&#39;: u&#39;NONE&#39;, u&#39;OPERATIONS&#39;: u&#39;5&#39;, u&#39;NAME&#39;: u&#39;BOOST_STATE&#39;, u&#39;MIN&#39;: u&#39;0&#39;,</span>
    <span class="c1">#  u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;30&#39;, u&#39;TAB_ORDER&#39;: u&#39;4&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;,</span>
    <span class="c1">#  u&#39;TYPE&#39;: u&#39;INTEGER&#39;, u&#39;ID&#39;: u&#39;BOOST_STATE&#39;, u&#39;UNIT&#39;: u&#39;min&#39;}</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">boost_duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;When boost mode is currently active this returns the number of minutes left</span>
<span class="sd">        in boost mode. Otherwise it returns ``None``.</span>

<span class="sd">        Provides the configured boost duration as :class:`ParameterINTEGER`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">control_mode</span> <span class="o">==</span> <span class="s2">&quot;BOOST&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;BOOST_STATE&quot;</span><span class="p">]</span></div>

<span class="c1"># Funk-Wandthermostat</span>
<span class="k">class</span> <span class="nc">HM_TC_IT_WM_W_EU</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-TC-IT-WM-W-EU&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current temperature.</span>

<span class="sd">        Returns an instance of :class:`ParameterFLOAT`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ACTUAL_TEMPERATURE&quot;</span><span class="p">]</span>


    <span class="c1">#{u&#39;CONTROL&#39;: u&#39;NONE&#39;, u&#39;OPERATIONS&#39;: u&#39;5&#39;, u&#39;NAME&#39;: u&#39;VALVE_STATE&#39;, u&#39;MIN&#39;: u&#39;0&#39;,</span>
    <span class="c1"># u&#39;DEFAULT&#39;: u&#39;0&#39;, u&#39;MAX&#39;: u&#39;99&#39;, u&#39;TAB_ORDER&#39;: u&#39;3&#39;, u&#39;FLAGS&#39;: u&#39;1&#39;, u&#39;TYPE&#39;: u&#39;INTEGER&#39;,</span>
    <span class="c1"># u&#39;ID&#39;: u&#39;VALVE_STATE&#39;, u&#39;UNIT&#39;: u&#39;%&#39;}</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">humidity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current valve state in percentage.</span>

<span class="sd">        Returns an instance of :class:`ParameterINTEGER`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ACTUAL_HUMIDITY&quot;</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">set_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The actual set temperature of the device.</span>

<span class="sd">        :getter: Provides the actual target temperature as :class:`ParameterFLOAT`.</span>
<span class="sd">        :setter: Specify the new set temperature as float. Please note that the CCU rounds</span>
<span class="sd">                 this values to</span>
<span class="sd">                 .0 or .5 after the comma. So if you provide .e.g 22.1 as new set temperature,</span>
<span class="sd">                 the CCU will convert this to 22.0. This is totally equal to the control on the</span>
<span class="sd">                 device.</span>
<span class="sd">        :type: ParameterFloat/float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SET_TEMPERATURE&quot;</span><span class="p">]</span>


    <span class="nd">@set_temperature</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">set_temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;SET_TEMPERATURE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">target</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is set to `True` when the device is not enabled to heat.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_temperature</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="mf">4.5</span>


    <span class="k">def</span> <span class="nf">turn_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call this method to tell the thermostat that it should not heat.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_temperature</span> <span class="o">=</span> <span class="mf">4.5</span>


<span class="c1"># Funk-Temperatur-/Luftfeuchtesensor OTH</span>
<div class="viewcode-block" id="HM_WDS10_TH_O"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_WDS10_TH_O">[docs]</a><span class="k">class</span> <span class="nc">HM_WDS10_TH_O</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-WDS10-TH-O&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current temperature.</span>

<span class="sd">        Returns an instance of :class:`ParameterFLOAT`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;TEMPERATURE&quot;</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">humidity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current humidity.</span>

<span class="sd">        Returns an instance of :class:`ParameterFLOAT`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;HUMIDITY&quot;</span><span class="p">]</span></div>



<span class="c1"># Funk-Temperatur-/Luftfeuchtesensor ITH</span>
<div class="viewcode-block" id="HM_WDS40_TH_I_2"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_WDS40_TH_I_2">[docs]</a><span class="k">class</span> <span class="nc">HM_WDS40_TH_I_2</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-WDS40-TH-I-2&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">temperature</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current temperature.</span>

<span class="sd">        Returns an instance of :class:`ParameterFLOAT`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;TEMPERATURE&quot;</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">humidity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current humidity.</span>

<span class="sd">        Returns an instance of :class:`ParameterFLOAT`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;HUMIDITY&quot;</span><span class="p">]</span></div>



<span class="c1"># Funk-Außen-Helligkeitssensor OLI</span>
<div class="viewcode-block" id="HM_Sen_LI_O"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_Sen_LI_O">[docs]</a><span class="k">class</span> <span class="nc">HM_Sen_LI_O</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-Sen-LI-O&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">brightness</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides the current brightness.</span>

<span class="sd">        Returns an instance of :class:`ParameterFLOAT`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;LUX&quot;</span><span class="p">]</span></div>



<span class="c1"># Virtuelle Fernbedienung der CCU</span>
<span class="k">class</span> <span class="nc">HM_RCV_50</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-RCV-50&quot;</span>



<span class="c1"># Funk-Tür-/ Fensterkontakt</span>
<div class="viewcode-block" id="HM_Sec_SC"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_Sec_SC">[docs]</a><span class="k">class</span> <span class="nc">HM_Sec_SC</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-Sec-SC&quot;</span>


    <span class="c1"># Make methods of ChannelShutterContact() available</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span></div>



<span class="c1"># Optischer Funk-Tür-/ Fensterkontakt</span>
<div class="viewcode-block" id="HM_Sec_SCo"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_Sec_SCo">[docs]</a><span class="k">class</span> <span class="nc">HM_Sec_SCo</span><span class="p">(</span><span class="n">HM_Sec_SC</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-Sec-SCo&quot;</span></div>



<span class="c1"># Funk-Schaltaktor mit Leistungsmessung</span>
<div class="viewcode-block" id="HM_ES_PMSw1_Pl"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_ES_PMSw1_Pl">[docs]</a><span class="k">class</span> <span class="nc">HM_ES_PMSw1_Pl</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-ES-PMSw1-Pl&quot;</span>


    <span class="c1"># Make methods of ChannelSwitch() available</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">HM_ES_PMSw1_Pl</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_summary_state</span><span class="p">(</span>
            <span class="n">skip_channel_types</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ChannelConditionPower&quot;</span><span class="p">,</span> <span class="s2">&quot;ChannelConditionCurrent&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;ChannelConditionVoltage&quot;</span><span class="p">,</span> <span class="s2">&quot;ChannelConditionFrequency&quot;</span><span class="p">])</span></div>



<span class="c1"># Funk-Schaltaktor ohne Leistungsmessung</span>
<div class="viewcode-block" id="HM_LC_Sw1_Pl_DN_R1"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_LC_Sw1_Pl_DN_R1">[docs]</a><span class="k">class</span> <span class="nc">HM_LC_Sw1_Pl_DN_R1</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-LC-Sw1-Pl-DN-R1&quot;</span>


    <span class="c1"># Make methods of ChannelSwitch() available</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">summary_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">HM_LC_Sw1_Pl_DN_R1</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">_get_summary_state</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">switch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides to the :class:`.ChannelKey` object of the switch.</span>

<span class="sd">        You can do something like ``self.switch.switch_on()`` with this. For details take</span>
<span class="sd">        a look at the methods provided by the :class:``.ChannelKey`` class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>



<span class="c1"># Funk-Rolladenaktor</span>
<div class="viewcode-block" id="HM_LC_Bl1PBU_FM"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_LC_Bl1PBU_FM">[docs]</a><span class="k">class</span> <span class="nc">HM_LC_Bl1PBU_FM</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-LC-Bl1PBU-FM&quot;</span>


    <span class="c1"># Make methods of ChannelBlind() available</span>
    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">attr</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">blind</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides to the :class:`.ChannelKey` object of the blind channel.</span>

<span class="sd">        You can do something like ``self.blind.set_level(0.6)`` with this. For details take</span>
<span class="sd">        a look at the methods provided by the :class:``.ChannelKey`` class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>



<div class="viewcode-block" id="HM_PBI_4_FM"><a class="viewcode-back" href="../../pmatic_devices.html#pmatic.entities.HM_PBI_4_FM">[docs]</a><span class="k">class</span> <span class="nc">HM_PBI_4_FM</span><span class="p">(</span><span class="n">Device</span><span class="p">):</span>
    <span class="n">type_name</span> <span class="o">=</span> <span class="s2">&quot;HM-PBI-4-FM&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">switch1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides to the :class:`.ChannelKey` object of the first switch.</span>

<span class="sd">        You can do something like ``self.switch1.press_short()`` with this. For details take</span>
<span class="sd">        a look at the methods provided by the :class:``.ChannelKey`` class.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">switch2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides to the :class:`.ChannelKey` object of the second switch.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">switch3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides to the :class:`.ChannelKey` object of the third switch.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">switch4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides to the :class:`.ChannelKey` object of the fourth switch.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span></div>



<div class="viewcode-block" id="Rooms"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms">[docs]</a><span class="k">class</span> <span class="nc">Rooms</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Manages a collection of rooms.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccu</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Rooms</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ccu</span><span class="p">,</span> <span class="n">pmatic</span><span class="o">.</span><span class="n">ccu</span><span class="o">.</span><span class="n">CCU</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;Invalid ccu object provided: </span><span class="si">%r</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ccu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span> <span class="o">=</span> <span class="n">ccu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_room_dict</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_rooms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Optional initializer of the rooms data structure, called on first access.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_room_dict</span>


<div class="viewcode-block" id="Rooms.get"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room_id</span><span class="p">,</span> <span class="n">deflt</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the :class:`Room` matching the given room id.</span>

<span class="sd">        If there is none matching the given ID either None or the value</span>
<span class="sd">        specified by the optional attribute *deflt* is returned.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">room_id</span><span class="p">,</span> <span class="n">deflt</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides a sorted list of all ids of all initialized room.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>


<div class="viewcode-block" id="Rooms.add"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a :class:`Room` to the collection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">room</span><span class="p">,</span> <span class="n">Room</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">PMException</span><span class="p">(</span><span class="s2">&quot;You can only add Room objects.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="p">[</span><span class="n">room</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">room</span></div>


<div class="viewcode-block" id="Rooms.exists"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms.exists">[docs]</a>    <span class="k">def</span> <span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check whether or not a :class:`Room` with the given id is in this collection.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">room_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span></div>


<div class="viewcode-block" id="Rooms.delete"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">room_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes the :class:`Room` with the given id from the pmatic runtime.</span>

<span class="sd">        The room is not deleted from the CCU. When the room is not known, the method is</span>
<span class="sd">        tollerating that.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="p">[</span><span class="n">room_id</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="Rooms.clear"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all :class:`Room` objects from this collection.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<div class="viewcode-block" id="Rooms.__iter__"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms.__iter__">[docs]</a>    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides an iterator over the rooms of this collection.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">utils</span><span class="o">.</span><span class="n">is_py2</span><span class="p">():</span>
            <span class="n">mylist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">mylist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">mylist</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Rooms.__len__"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Rooms.__len__">[docs]</a>    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Is e.g. used by :func:`len`. Returns the number of rooms in this collection.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rooms</span><span class="p">)</span></div></div>



<div class="viewcode-block" id="Room"><a class="viewcode-back" href="../../pmatic_module.html#pmatic.entities.Room">[docs]</a><span class="k">class</span> <span class="nc">Room</span><span class="p">(</span><span class="n">Entity</span><span class="p">):</span>
    <span class="n">_transform_attributes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span>               <span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="s2">&quot;channelIds&quot;</span>       <span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">x</span><span class="p">)),</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Room</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">ccu</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>


    <span class="c1">#@classmethod</span>
    <span class="c1">#def get_rooms(self, api):</span>
    <span class="c1">#    &quot;&quot;&quot;Returns a list of all currently configured :class:`.Room` instances.&quot;&quot;&quot;</span>
    <span class="c1">#    rooms = []</span>
    <span class="c1">#    for room_dict in api.room_get_all():</span>
    <span class="c1">#        rooms.append(Room(api, room_dict))</span>
    <span class="c1">#    return rooms</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">devices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides access to a collection of :class:`.Device` objects which have at least one</span>
<span class="sd">        channel associated with this room.</span>

<span class="sd">        The collections is a :class:`.Devices` instance.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ccu</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">has_channel_ids</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channel_ids</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_devices</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Holds a list of channel objects associated with this room.&quot;&quot;&quot;</span>
        <span class="c1"># FIXME: Cache this?</span>
        <span class="n">room_channels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">device</span><span class="o">.</span><span class="n">channels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">channel</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">channel_ids</span><span class="p">:</span>
                    <span class="n">room_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">room_channels</span></div>


<span class="c1">#    @property</span>
<span class="c1">#    def programs(self):</span>
<span class="c1">#        &quot;&quot;&quot;Returns list of program objects which use at least one channel associated</span>
<span class="c1">#        with this room.&quot;&quot;&quot;</span>
<span class="c1">#        # FIXME: Implement!</span>
<span class="c1">#        # FIXME: Cache this?</span>
<span class="c1">#        return []</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#    def add(self, channel):</span>
<span class="c1">#        &quot;&quot;&quot;Adds a channel to this room.&quot;&quot;&quot;</span>
<span class="c1">#        # FIXME: Implement!</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1">#    def remove(self, channel):</span>
<span class="c1">#        &quot;&quot;&quot;Removes a channel to this room.&quot;&quot;&quot;</span>
<span class="c1">#        # FIXME: Implement!</span>


<span class="c1"># Build a list of all specific product classes. If a device is initialized</span>
<span class="c1"># Device() checks whether or not a specific class or the generic Device()</span>
<span class="c1"># class should be used to initialize an object.</span>
<span class="n">device_classes_by_type_name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Device</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;Device&quot;</span><span class="p">:</span>
            <span class="n">device_classes_by_type_name</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">type_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

<span class="n">channel_classes_by_type_name</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="nb">type</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Channel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">Channel</span><span class="p">:</span>
            <span class="n">channel_classes_by_type_name</span><span class="p">[</span><span class="n">val</span><span class="o">.</span><span class="n">type_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">pmatic 0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../pmatic.html" >pmatic</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2016, Lars Michelsen.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.2.
    </div>
  </body>
</html>